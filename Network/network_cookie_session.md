# Cookie & Session

## 목차
- [Cookie \& Session](#cookie--session)
  - [목차](#목차)
  - [1. 쿠키(Cookie)와 세션(Session)을 사용하는 이유](#1-쿠키cookie와-세션session을-사용하는-이유)
  - [🍪2. Cookie](#2-cookie)
    - [2.1 정의](#21-정의)
    - [2.2 특징](#22-특징)
    - [2.3 동작방식](#23-동작방식)
    - [2.4 사용목적](#24-사용목적)
    - [2.5 사용예시](#25-사용예시)
  - [3. 🧾 Session](#3--session)
    - [3.1 정의](#31-정의)
    - [3.2 특징](#32-특징)
    - [3.3 동작방식](#33-동작방식)
    - [3.4 사용목적](#34-사용목적)
    - [3.5 사용예시](#35-사용예시)
  - [4. 쿠키와 세션의 차이](#4-쿠키와-세션의-차이)
    - [5. 참조](#5-참조)

<hr>

## 1. 쿠키(Cookie)와 세션(Session)을 사용하는 이유
➡ HTTP 프로토콜의 특징 때문
1. Connectionless(비연결성)<br>
HTTP 프로토콜은 클라이언트에서 서버에 요청(Request)을 보내면 서버는 클라이언트에 응답(Response)을 하고 연결을 끊는 특징을 가지고 있다.<br>
> HTTP 1.1 버전에서 Connection 헤더에 keep-alive라고 설정하면 컨넥션을 유지하고, 요청에 재활용하는 기능이 추가 되었다. HTP 1.1 버전에서는 기본(default) 옵션이다.

2. Stateless(무상태)<br>
HTTP 통신은 연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보를 유지하지 않는 특징이 있으며, 이를 Stateless하다고 한다.<br><br>클라이언트와 첫 번째 통신에서 데이터를 주고받았다 해도, 두 번째 통신에서 이전 데이터를 유지하지 않는다. 하지만, 실제로는 데이터 유지가 필요한 경우가 많다.

## 🍪2. Cookie

### 2.1 정의
HTTP의 일종으로 사용자가 어떤 웹 사이트를 방문할 경우, 해당 사이트가 사용하고 있는 서버에서 `사용자의 컴퓨터에 저장하는 작은 기록 정보 파일`<br>
HTTP에서 클라이언트의 상태정보를 쿠키 형태로 클라이언트 PC에 저장하였다가 `필요 시 정보를 참조하거나 재사용`할 수 있다.

### 2.2 특징
- Key-Value쌍으로 구성되어 있는 데이터 파일이다.
- 쿠키이름, 쿠키값, 만료시간, 전송할 도메인명, 전송할 경로, 보안연결여부, HttpOnly여부로 구성되어 있다.
- 도메인 당 20개의 쿠키를 가질 수 있다.
- 하나의 쿠키는 4KB(= 4096 byte)까지 저장이 가능하다.
- 브라우저 개발자도구의 네트워크에서 쿠키값을 확인할 수 있지만, 가독성이 떨어지고 수정이 불가능하다.<br>
 (하지만 '브라우저의 쿠키 관리 탭' 또는 '쿠키 관리 플러그인'을 설치하면 쿠키를 쉽게 수정할 수 있다.)
 - 쿠키는 클라이언트에서 수정할 수 있기 때문에 위변조의 위험이 항상 존재한다. 따라서 쿠키값(value)를 암호화해야 하며, 민감하거나 중요한 정보를 담지 않도록 해야한다.


### 2.3 동작방식
<img src ="img\network_cookie.png">

1. 서버가 클라이언트로부터 요청을 받았을 때, 클라이언트에 대한 정보를 바탕으로 `set-cookie` 속성을 사용해 "쿠키"를 만든다

1. 서버는 클라이언트에게 해당 요청에 대한 응답을 보낼 때 응답의 Header부분에 쿠키를 담아 보낸다

    (서버로부터 쿠키가 담겨 오는 곳 : `response header`)

2. 클라이언트가 응답을 받으면 브라우저는 쿠키를 쿠키 디렉터리에 저장 후 또 다시 서버에 요청을 할 때 사용자가 가만히 있어도 브라우저가 `request header`에 쿠키를 담아서 서버에 전송한다. 

3. 서버는 또 다시 response에 쿠키 정보를 참조하여 응답한다. 

### 2.4 사용목적
쿠키는 주로 3가지 목적을 위해 사용한다.

1. 세션 관리(Session Management)
로그인, 사용자 닉네임, 접속 시간, 장바구니 등의 서버가 알아야할 정보들을 저장
2. 개인화(Personalization)
사용자마다 다르게 그 사람에 적절한 페이지를 보여줄 수 있다.
3. 트래킹(Tracking)
사용자의 행동과 패턴을 분석하고 기록

### 2.5 사용예시
1.  방문 사이트에서 로그인 시, "아이디와 비밀번호를 저장하시겠습니까?"
2. 팝업창을 통해 "오늘 이 창을 다시 보지 않기" 체크

## 3. 🧾 Session

### 3.1 정의
일정 시간 동안 같은 사용자(브라우저)로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지시키는 기술이다.<br>
여기서 일정 시간은 방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점부터 웹 브라우저를 종료하여 연결을 끝내는 시점을 말한다.<br>
즉, 브라우저가 종료되기 전까지 클라이언트의 요청을 유지하게 해주는 기술을 세션(`사용자가 웹서버에 접속해 있는 상태를 하나의 단위보고 세션`)이라고 한다.<Br>
  ex) 쇼핑 사이트에 엑세스 하여 장바구니에 상품을 넣고 구매 절차를 진행하는 일련의 흐름을 실현하는 기술 

### 3.2 특징
- 세션은 쿠키를 이용하여 구현된다.
- 웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장한다.
- 웹 서버에 저장되는 쿠키(세션 쿠키 / session cookie)이다.
- 브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제가 되기 때문에 쿠키보다 비교적 보안적으로 우수하다.
- 저장 데이터에 제한이 없다.(서버 용량 허용 범위 내에서)
- 각 클라이언트에 고유 세션 ID(Session ID)를 부여한다. 세션 ID를 통해 클라이언트를 구분하여 각 요구에 맞는 서비스를 제공한다.
- 세션의 내용은 서버에 저장되기 때문에 계속하여 늘어날 경우 서버에 부하가 발생할 수 있다.
- 세션에 대한 정보가 서버에 있어 쿠키에 비해 비교적 속도가 느리다.
- 
### 3.3 동작방식
<img src ="img\network_session.jpg">

1. 클라이언트가 서버에 요청
2. 서버는 클라이언트의 요청의 유효성을 확인하고 unique한 id를 session ID로 생성하여 저장한다.\
3. 서버가 응답할 때 응답헤더에 세션 ID를 쿠키에 추가하여 응답합니다.
4. 클라이언트는 이후 서버에 요청할 때 전달받은 세션 ID를 쿠키에 자동으로 요청 헤더에 추가하여 요청한다.
5. 서버에서는 요청 헤더의 세션 ID 값을 저장된 세션 저장소에서 찾아보고 유효한지 확인 후 요청을 처리하고 응답한다.

### 3.4 사용목적
- 사용자나 다른 누군가에게 노출되면 안되는 보안적으로 중요한 정보들을 서버 안에서 다루기 위해 사용한다.

### 3.5 사용예시
- 로그인 같이 보안상 중요한 작업을 수행할 때 사용

## 4. 쿠키와 세션의 차이
1. 사용자의 정보가 저장되는 위치
    - 쿠키는 클라이언트의 웹 브라우저가 지정하는 메모리 또는 하드디스크
    - 세션은 서버의 자원을 사용한다.

2. 보안

    - 쿠키는 클라이언트 로컬에 저장되기 때문에 변질되거나 request에서 스니핑 당할 우려가 있어서 보안에 취약하지만 

    - 세션은 쿠키를 이용해서 session-id만 저장하고 그것으로 구분하여 서버에서 처리하기 때문에 비교적 보안성이 높다.

3. 라이프 사이클

    - 쿠키는 브라우저를 종료해도 정보가 유지될 수 있으며 만료기간을 따로 지정해 쿠키를 삭제할 때까지 유지할 수도 있다. (저장할 때 expires 속성을 정의해 삭제될 날짜 지정 가능)

   - 세션은 만료기간을 정할 수 있긴 하지만 브라우저가 종료되면 만료기간에 상관없이 삭제된다.

4. 속도

   - 쿠키는 정보가 클라이언트에 있기 때문에 서버에 요청 시 속도가 빠르며

   - 세션은 정보가 서버에 있기 때문에 처리가 요구되어 비교적 속도가 느리다





### 5. 참조
https://velog.io/@octo__/%EC%BF%A0%ED%82%A4Cookie-%EC%84%B8%EC%85%98Session
<br>
https://judahhh.tistory.com/46#%EC%BF%A-%ED%--%A--cookie-
<br>
https://interconnection.tistory.com/74