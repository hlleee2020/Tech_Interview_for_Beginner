# 🎯 TLB(Translation Lookaside Buffer)
TLB란 가상 주소를 물리적 주소로 변환하는 과정에서 사용되는 고속 메모리 하드웨어이다. 이는 메모리 관리 유닛인 MMU에 의해 관리된다.

그러면 TLB는 왜 필요할까?

## 📍 TLB의 목적
> TLB : 가상 메모리 주소를 물리적 주소로 변환하는 속도를 높이기 위해 사용하는 캐시

페이지 테이블에 자주 접근하는 것은 여러가지 이유로 비효율적이다. 그 중 하나로는 추가적인 메모리 접근이다. 페이지 테이블은 메모리 상에 위치하고 가상 주소를 물리 주소로 변환하는 데 사용된다. CPU가 프로그램의 데이터가 접근하려 할 때마다 페이지 테이블을 조회하기 때문에 이러한 과정이 반복되면 시스템의 전반적인 성능에 부정적인 영향을 미칠 수 있다. 그렇기 때문에 TLB는 자주 사용되는 주소 변환을 제공하면서 이러한 비효율을 감소시킬 수 있다.

TLB는 CPU가 메모리에 접근할 때 발생하는 지연 시간을 줄여서 시스템의 전반적인 성능을 향상 시킨다. 메모리 접근할 때마다 페이지 테이블을 검색하는 대신, TLB를 먼저 확인하여 빠른 주소 변환을 한다.

## 📍 TLB 작동방식
-  CPU가 발생시킨 가상 주소가 TLB에 존재하는지 검사하고, 존재한다면 빠르게 물리 주소로 변환한다. 만약 TLB 미스가 발생한다면, 물리 메모리에 있는 페이지 테이블로부터 주소를 검색하여 TLB를 업데이트 한다.

- 만약 페이지 테이블에도 없다면 페이지 폴트 처리 루틴을 수행한다. 운영체제는 CPU에게 페이지를 Fetch하도록 명령한다. CPU는 입출력장치를 활성화시키고 디스크에서 주기억장치로 페이지를 전송한다. 만약 주기억장치가 가득 찼다면 페이지 교체가 수행된다. 페이지가 주기억 장치에 할당되면 페이지 테이블을 갱신한다. 그리고 CPU는 다시 TLB 검사를 하는데 TLB에는 아직 페이지 정보가 없다. 그렇기 때문에 페이지 테이블을 검사하고 새로 반입된 페이지가 존재하게 되면 이는 새로 참조된 페이지이므로 TLB를 갱신하고 CPU가 논리주소를 물리주소로 변환하면 과정을 끝난다.

<img src="./img/os_tlb_1.png" alt="os_tlb_1">

- TLB 히트는 요청된 페이지의 주소 정보가 TLB에 이미 존재할 때 발생하며, TLB 미스는 해당 정보가 없을 때 발생한다.

- 오프셋은 주로 가상 주소와 물리 주소 모두에 있어서 페이지 내에서의 특정 위치를 가리키는 데 사용된다. 가상 주소를 물리 주소를 변환할 때 오프셋은 변환 과정에서 변경되지 않고 그대로 유지된다. 다시 말하면, 오프셋은 메모리 페이지 내에서의 상대적인 위치를 가리키며, 가상 주소를 물리 주소로 변환할 때 이 오프셋 값은 그대로 사용되어, 프로세스가 요청한 데이터를 정확한 메모리 위치에서 찾을 수 있도록 한다.

## 📍 TLB 한계점
TLB는 크기가 제한적이기 때문에 모든 페이지 정볼르 저장할 수 없고 이로 인해 TLB 미스가 발생할 수 있다. 또한 프로세스 간 context switching이 발생할 때, TLB 내용은 대부분 무효화 되거나 새로운 프로세스의 매핑으로 갱신된다.

# ✅ 출처
- https://velog.io/@becooq81/운영체제-TLB

- https://lordofkangs.tistory.com/244

- https://velog.io/@orcasuit/Translation-Lookaside-Buffer-TLB